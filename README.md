## :atm: Приложение, иммитирующее работу банкомата 

### :pencil: Техническое описание 
Приложение иммитирущее работу банкомата написано на языке программирования ***Java***, представляет из себя 2 ***Spring Boot*** приложения: банкомат (клиент) и сервер. Взаимодействие приложений реализовано с использованием ***REST***. В качестве системы сборки используется ***Maven***. Для хранения информации о клиенте используется СУБД ***PostgreSQL***.

#### :file_folder: Компоненты программы: 
- Client - модуль, реализующий работу банкомата, отвечает за денежные запросы к серверу, проверяет правильность введённых данных.
- Server - модуль, реализующий работу сервера, принимает запросы от клиента, реализует взаимодействие с БД для удовлетворения требования и возвращает необходимый результат.
- Common - модуль, отвечающий за общие данные, используемые при общении модулей Client и Server.

#### :floppy_disk: Хранилище данных 
При организации хранилища данных, использовались следующие утверждения:
1) Каждая карта уникальна.
2) Каждый клиент уникален.
3) У одного клиента может быть несколько карт.
4) У карты может быть только один владелец (клиент).

По данным утверждениям было организовано следующее хранилище данных:
![image](https://user-images.githubusercontent.com/59023791/162625353-d92a9025-9a86-4478-a59c-82d771b64db2.png)

**SQL скрипты создания карты и клиента соответственно:**
```
CREATE TABLE Cards(
                      id_card SERIAL,
                      pin INT,
                      balance NUMERIC,
                      id_client INT NOT NULL,
                      FOREIGN KEY (id_client) REFERENCES Clients(id_client),
                      PRIMARY KEY(id_card)
);
```

```
CREATE TABLE Clients(
                        id_client SERIAL,
                        name VARCHAR(15),
                        surname VARCHAR(20),
                        patronymic VARCHAR(20),
                        date_of_birth DATE,
                        PRIMARY KEY(id_client)
);
```
### :computer: Пример использования
В качестве примера воспользуемся ***[Postman](https://www.postman.com/company/about-postman/).***
   
На данном этапе клиент может выполнить 3 вида операций по своей карте:
1) ***Узнать баланс***           
>  
>Для выполнения данного действия необходимо ввести следующий запрос в Postman:
>```
>http://localhost:1704/atms/cards/1/pin/1 
>``` 
>>`cards/1` - 1 отвечает за номер карты.
>>  
>>`pin/1` - 1 отвечает за пин-код карты.
>>> __В случае успешного выполнения отобразятся следующие данные:(bold)__
>>>   
>>> `Ваш баланс = [Денежные средства] руб.`
>>>
2) ***Снять денежные средства с карты***   
>   
>Для выполнения данного действия необходимо ввести следующий запрос в Postman:
>```
>http://localhost:1704/atms/deposit/cards/1/pin/1/money/1000
>```
>>   
>>`money/1000` - 1000 отвечает за количество денежных средств для снятия с карты.
>>  
>>>__В случае успешного выполнения отобразятся следующие данные:(bold)__
>>>   
>>>`Вы внесли денежные средства на карту. Ваш баланс составляет = [Денежные средства] руб.`
>>>   
3) ***Положить денежные средства на карту***
>   
> Для выполнения данного действия необходимо ввести следующий запрос в Postman:
>```
>http://localhost:1704/atms/withdraw/cards/1/pin/1/money/10000 
>```
>>`money/1000` - 1000 отвечает за количество денежных средств для пополнения карты.
>>   
>>>__В случае успешного выполнения отобразятся следующие данные: (bold)__
>>>   
>>>`Вы сняли денежные средства с карты. 
>>>   Ваш баланс составляет = [Денежные средства] руб.`
   
### :x: Обработка ошибок
   
В следующей таблице приведены основные возможные ошибки при использовании приложения с соответствующими сообщениями при их возникновении, а также возможный вариант их решения.
   
   | ОШИБКА | СООБЩЕНИЕ | РЕШЕНИЕ |
|----------------|:---------:|----------------:|
| Направильный формат ввода номера карты | "Проверьте правильность Вашего запроса." | Номер карты должен быть положительным целым числом |
| Направильный формат ввода PIN | "Проверьте правильность Вашего запроса." | PIN код должен быть положительным целым числом |
| Неверный логин или PIN | "Ошибка аутентификации" | Необходимо проверить правильность введённых учётных данных |
| Введенна недоступная для снятия денежная сумма | "На Вашем счёте недостаточно средств." | Проверьте остаток средств на счёте и повторите операцию с доступной суммой |
   
   
## :speech_balloon: В разработке 
В данный момент идёт внедрение безопасности: аутентификации с использованием ***Spring Security и JSON Web Tokens***.
   
В клиентском приложении необходимо выполнить запрос-аутентификацию для получения уникального ключа, который открывает возможность воспользоваться основными функциями приложения. В противном случае в доступе будет отказано.
   
В данный момент идёт работа над следующей ошибкой: пользователь может получить ключ, а затем спокойно снимать денежные средства с любого счёта, указав в теле запроса номер другой карты.
   
Ход данной разработки можно увидеть в ветке ~SECURITY_JWT_004~.
   
После внедрения аутентификации планируется реализовать авторизацию с введением неиспользуемого раннее функционала - информации о пользователях.

![image](https://user-images.githubusercontent.com/59023791/162626773-e95b9cda-928e-4474-8b9d-e8770f2d9346.png)
